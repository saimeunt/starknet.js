
  <!DOCTYPE html>
  <html>
    <head>
      <title>shortString.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/utils/shortString.ts</td><td class="">94.44%</td><td class="">80%</td><td class="">90</td><td class="">85</td><td class="">5</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { TEXT_TO_FELT_MAX_LEN } from &#x27;../constants&#x27;;
import { addHexPrefix, removeHexPrefix } from &#x27;./encode&#x27;;
import { isHex, isStringWholeNumber } from &#x27;./num&#x27;;

/**
 * Test if string contains only ASCII characters (string can be ascii text)
 */
export function isASCII(str: string) {
  // eslint-disable-next-line no-control-regex
  return /^[\x00-\x7F]*$/.test(str);
}

/**
 * Test if string is a Cairo short string (string has less or equal 31 characters)
 */
export function isShortString(str: string) {
  return str.length &lt;= TEXT_TO_FELT_MAX_LEN;
}

/**
 * Test if string contains only numbers (string can be converted to decimal number)
 */
export function isDecimalString(str: string): boolean {
  return /^[0-9]*$/i.test(str);
}

/**
 * Checks if a given value is a string.
 *
 * @param {unknown} value - The value to be checked.
 * @return {boolean} - Returns true if the value is a string, false otherwise.
 */
export function isString(value: unknown): value is string {
  return typeof value === &#x27;string&#x27;;
}

/**
 * Test if value is a free-from string text, and not a hex string or number string
 */
export function isText(val: any) {
  return isString(val) &amp;&amp; !isHex(val) &amp;&amp; !isStringWholeNumber(val);
}

/**
 * Test if value is short text
 */
export const isShortText = (val: any) =&gt; isText(val) &amp;&amp; isShortString(val);

/**
 * Test if value is long text
 */
export const isLongText = (val: any) =&gt; isText(val) &amp;&amp; !isShortString(val);

/**
 * Split long text into short strings
 */
export function splitLongString(longStr: string): string[] {
  const regex = RegExp(`[^]{1,${TEXT_TO_FELT_MAX_LEN}}`, &#x27;g&#x27;);
  return longStr.match(regex) || [];
}

/**
 * Convert an ASCII string to a hexadecimal string.
 * @param str short string (ASCII string, 31 characters max)
 * @returns format: hex-string; 248 bits max
 * @example
 * ```typescript
 * const myEncodedString: string = encodeShortString(&quot;uri/pict/t38.jpg&quot;);
 * // return hex string (ex.&quot;0x7572692f706963742f7433382e6a7067&quot;)
 * ```
 */
export function encodeShortString(str: string): string {
  if (!isASCII(str)) throw new Error(`${str} is not an ASCII string`);
  if (!isShortString(str)) throw new Error(`${str} is too long`);
  return addHexPrefix(str.replace(/./g, (char) =&gt; char.charCodeAt(0).toString(16)));
}

/**
 * Convert a hexadecimal or decimal string to an ASCII string.
 * @param str representing a 248 bit max number (ex. &quot;0x1A4F64EA56&quot; or &quot;236942575435676423&quot;)
 * @returns format: short string; 31 characters max
 * @example
 * ```typescript
 * const myDecodedString: string = decodeShortString(&quot;0x7572692f706963742f7433382e6a7067&quot;);
 * // return string (ex.&quot;uri/pict/t38.jpg&quot;)
 * ```
 */
export function decodeShortString(str: string): string {
  if (!isASCII(str)) throw new Error(`${str} is not an ASCII string`);
  if (isHex(str)) {
    return removeHexPrefix(str).replace(/.{2}/g, (hex) =&gt; String.fromCharCode(parseInt(hex, 16)));
  }
  if (isDecimalString(str)) {
    return decodeShortString(&#x27;0X&#x27;.concat(BigInt(str).toString(16)));
  }
  throw new Error(`${str} is not Hex or decimal`);
}
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src/utils/shortString.ts&quot;,&quot;line&quot;:39,&quot;character&quot;:23,&quot;text&quot;:&quot;val&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/shortString.ts&quot;,&quot;line&quot;:46,&quot;character&quot;:28,&quot;text&quot;:&quot;val&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/shortString.ts&quot;,&quot;line&quot;:46,&quot;character&quot;:48,&quot;text&quot;:&quot;val&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/shortString.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:27,&quot;text&quot;:&quot;val&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src/utils/shortString.ts&quot;,&quot;line&quot;:51,&quot;character&quot;:47,&quot;text&quot;:&quot;val&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 25 Apr 2024 15:57:37 GMT</p>
    </body>
  </html>
  