
  <!DOCTYPE html>
  <html>
    <head>
      <title>address.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src/utils/address.ts</td><td class="">100.00%</td><td class="">80%</td><td class="">75</td><td class="">75</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">/* eslint-disable no-bitwise */
import { hexToBytes } from &#x27;@noble/curves/abstract/utils&#x27;;

import { ADDR_BOUND, ZERO } from &#x27;../constants&#x27;;
import { BigNumberish } from &#x27;../types&#x27;;
import { addHexPrefix, removeHexPrefix } from &#x27;./encode&#x27;;
import { keccakBn } from &#x27;./hash&#x27;;
import { assertInRange, toHex } from &#x27;./num&#x27;;

/**
 * Format a hex number to &#x27;0x&#x27; and 64 characters, adding leading zeros if necessary.
 * @param {BigNumberish} address
 * @returns {string} Hex string : 0x followed by 64 characters. No upper case characters in the response.
 */
export function addAddressPadding(address: BigNumberish): string {
  return addHexPrefix(removeHexPrefix(toHex(address)).padStart(64, &#x27;0&#x27;));
}

/**
 * Check the validity of a Starknet address, and format it as a hex number : &#x27;0x&#x27; and 64 characters, adding leading zeros if necessary.
 * @param {BigNumberish} address
 * @returns {string} Hex string : 0x followed by 64 characters. No upper case characters in the response.
 */
export function validateAndParseAddress(address: BigNumberish): string {
  assertInRange(address, ZERO, ADDR_BOUND - 1n, &#x27;Starknet Address&#x27;);

  const result = addAddressPadding(address);

  if (!result.match(/^(0x)?[0-9a-fA-F]{64}$/)) {
    throw new Error(&#x27;Invalid Address Format&#x27;);
  }

  return result;
}

/**
 * Computes the checksum address for the given Starknet address.
 *
 * From https://github.com/ethers-io/ethers.js/blob/fc1e006575d59792fa97b4efb9ea2f8cca1944cf/packages/address/src.ts/index.ts#L12
 * @param {BigNumberish} address - The address to compute the checksum for.
 *
 * @returns {string} The checksum address.
 */
export function getChecksumAddress(address: BigNumberish): string {
  const chars = removeHexPrefix(validateAndParseAddress(address)).toLowerCase().split(&#x27;&#x27;);
  const hex = removeHexPrefix(keccakBn(address));
  const hashed = hexToBytes(hex.padStart(64, &#x27;0&#x27;));

  for (let i = 0; i &lt; chars.length; i += 2) {
    if (hashed[i &gt;&gt; 1] &gt;&gt; 4 &gt;= 8) {
      chars[i] = chars[i].toUpperCase();
    }
    if ((hashed[i &gt;&gt; 1] &amp; 0x0f) &gt;= 8) {
      chars[i + 1] = chars[i + 1].toUpperCase();
    }
  }

  return addHexPrefix(chars.join(&#x27;&#x27;));
}

/**
 * If the casing of an address is mixed, it is a Checksum Address, which uses a specific pattern of uppercase and lowercase letters within
 * a given address to reduce the risk of errors introduced from typing an address or cut and paste issues.
 *
 * @param address string
 *
 * @returns true if the ChecksumAddress is valid
 */
export function validateChecksumAddress(address: string): boolean {
  return getChecksumAddress(address) === address;
}
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 25 Apr 2024 15:57:38 GMT</p>
    </body>
  </html>
  